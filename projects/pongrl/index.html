<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BBEHWW29ER"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-BBEHWW29ER');
    </script>
    
    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pong Reinforcement Learning | Somnath  Kumar</title>
    <meta name="author" content="Somnath  Kumar">
    <meta name="description" content="Implementation of Policy Gradient on self made Pong game.">
    <meta name="keywords" content="somnath kumar, website, research">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/gen_icon.png">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="http://localhost:4000/projects/pongrl/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    
  </head>

  <!-- Body -->
  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">SomnathÂ </span>Kumar</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- page.html -->
        <div class="post">

          <header class="post-header">
            <h1 class="post-title">Pong Reinforcement Learning</h1>
            <p class="post-description">Implementation of Policy Gradient on self made Pong game.</p>
            
              
                  <a href="https://github.com/hex-plex/Pong-ReinforcementLearning" class="btn" rel="external nofollow noopener" target="_blank">
                    <i class="fab fa-github"></i> Code and Details
                  </a>
              
            
            <hr>
            
              <img src="/assets/img/projects/pongrl/featured.jpg" alt="Pong Reinforcement Learning" class="post-image">
              
                  
                    <p class="post-image-caption"></p>
<center>Pong game demo written with pygame</center>
                  
              
            
          </header>

          <article>
            <p>I have tried baking a rudimentary RL environment and a agent recipe to learn more about the eco-system.<br>
I have made <a href="https://github.com/hex-plex/Pong-ReinforcementLearning/blob/master/pong.py" rel="external nofollow noopener" target="_blank">pong.py</a> a environment which one can host either locally (localhost) or on  0.0.0.0 (LAN).Allowing to communicate to <a href="https://github.com/hex-plex/Pong-ReinforcementLearning/blob/master/mainmodel.py" rel="external nofollow noopener" target="_blank">mainmodel.py</a> which has to be connected to the same host and the same port. <br>
I have used a simple socket connection to transfer data rather than a flask/django backend as they are based on it giving a advantage of speed of communication. <br>
both the scripts have debug mode which allows one to see in which state or stage they are in. <br></p>
<h2 id="output">Output</h2>
<p><img src="https://github.com/hex-plex/Pong-ReinforcementLearning/raw/master/trained.gif" alt="pong-agent"></p>
<hr>

<p>The one on the left is a RL agent trained for 3 days and the one on right is a hardcoded AI. This is noticible the they nearly have the same level of skills.</p>

<h2 id="requirements">Requirements</h2>
<p>This requires only few basic libraries it only runs on python3, rather a small update can make it compatible with python2.
The libraries</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pickle
numpy
cv2
pygame
<span class="c"># Below are mostly available preinstalled in any python distribution</span>
socket
BytesIO <span class="c"># from io in python3 or directly in python2</span>
_thread <span class="c"># for python 3 and thread in python2</span>
</code></pre></div></div>
<p>Which are quite rudimentary and neccessary part of the code.</p>

<h2 id="multithreading">Multithreading</h2>
<p>Here I have use many threads to assure that no data is missed while any other calculation or process is running on the main thread as there might be some unwanted lag between inputs.Also another thread on mainmodel exists which take inputs  from the user for pausing and resuming its learning session</p>
<h2 id="sockets">Sockets</h2>
<p>I have used sockets to send data between scripts rather than using a instance of model and the pong env on the same script well that would work just fine (or better removing all the lag of communication) , but my goal was to make it more appealing and to make me learn more real life skills that is if I train a agent with raspberry pi ( or any other weaker mobile device for that matter ) as a part of the environment or in the environment a more viable option than running both simulation and the RL agent would be to do the computation and send in actions to it. This also gave me a good understanding about data compression and network security ,though here there is none used as it just accepts the first connection to the env. <br>
<br>
with the use of socket one could manually control the environment with keyboard and also have a RL agent learning (half - Duplex).</p>

<h2 id="demo">Demo</h2>
<p>To launch the env with mostly default values just running <a href="https://github.com/hex-plex/Pong-ReinforcementLearning/blob/master/pong.py" rel="external nofollow noopener" target="_blank">pong.py</a> directly would start the server with default configs.
Its always recommended to use its instance, apply your configuration you want it to run and start the server.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pong</span> <span class="kn">import</span> <span class="n">Pong</span>

<span class="n">env</span> <span class="o">=</span> <span class="nc">Pong</span><span class="p">(</span> <span class="n">levelodiff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1">## This is the level of the inbuilt AI that plays against you.
</span>                          <span class="c1">## Set it to 4 and chill out (really try it!!) the scale is 1-3
</span>            <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>  <span class="c1">## If set to True it will print the stage the environment is in and info the data inputs and outputs
</span>            <span class="n">render</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="c1">## It would render the image that is sent to the model, This slows down the process so not a good idea to use it.
</span>            <span class="n">server</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1">## This is to set server mode on , if set false the environment will be no different from ordinary pong game.
</span>            <span class="n">host</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span>      <span class="c1">## This is to specify where you want to host it, "" maps to local host "0.0.0.0" doesnt really map
</span>                          <span class="c1">## to your ip address yet
</span>            <span class="n">port</span><span class="o">=</span><span class="mi">12345</span>    <span class="c1">## This your port no. of the connection.
</span>          <span class="p">)</span>               <span class="c1">## This is to just initiate the environment
</span>
<span class="n">env</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span><span class="c1">## This starts the env ie., hosts itself as per the given parameter and waits for a connection in async while continuing the game
</span></code></pre></div></div>

<p>To launch the RL agent running the <a href="https://github.com/hex-plex/Pong-ReinforcementLearning/blob/master/mainmodel.py" rel="external nofollow noopener" target="_blank">mainmodel.py</a> directly will run it in default config. <br>
To customize to your config import and create an instance and run the client. <br></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">mainmodel</span> <span class="kn">import</span> <span class="n">PolicyGradient</span>

<span class="c1">## This uses two hidden layer to out-put 2 probabilities
</span><span class="n">agent</span> <span class="o">=</span> <span class="nc">PolicyGradient</span><span class="p">(</span> <span class="n">resume</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>  <span class="c1">## This is usefull to continue training from previos checkpoint.
</span>                        <span class="n">render</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>   <span class="c1">## This will render the image got through the socket,useful if model is in another computer
</span>                        <span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>     <span class="c1">## If the value is None it trys to find a localhost , else specific host is to be provided as a str
</span>                        <span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>    <span class="c1">## default value is 12345 set is as required.
</span>                        <span class="n">hiddenUnits</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="c1">## This no of hiddenUnits in first layer depending on the dimension of input.
</span>                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1">## This is to set batch size for batch reiforcement learning rather than using single episode.
</span>                        <span class="n">learningRate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="c1">## This is to set learning rate
</span>                        <span class="n">gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>    <span class="c1">## This is to set gamma or the discount
</span>                        <span class="n">decayRate</span><span class="o">=</span><span class="mf">0.99</span> <span class="c1">## This is decayRate for RMSprop
</span>                      <span class="p">)</span>                <span class="c1">## This creates an instance of PolicyGradient algorithm as a client_socket
</span>
<span class="n">agent</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>         <span class="c1">## This starts the agent ie., connects to the server and communicates and learns from its experience.
</span></code></pre></div></div>

<p>Running them should launch the env and agent would start leaning. There is a propriety control in mainmodel.py which takes input in its terminal as</p>
<ul>
  <li>âpâ    ==&gt; Pausing/Resuming the training process</li>
  <li>âqâ    ==&gt; Quit the training process , But this makes a Checkpoint as interrupt.p</li>
  <li>âpingâ ==&gt; This pings the pong server 10 times and returns the average time it took to send and receive packets.
else with a better score of agent, the model is saved continuosly as save.p.
    <h2 id="fast-training">Fast-training</h2>
    <p>I have experimented the whole thing with networking sockets and asynchronous methods limiting the training process to human level speed for which I have uploaded the pong-fast-train.tar.gz</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">tar</span> <span class="nt">-xvzf</span> pong-fast-train.tar.gz
<span class="nb">cd </span>pong-fast
python mainmodel.py
<span class="nb">mv </span>save.p ../save.p
</code></pre></div>    </div>
    <p>So this should train the model and save it into the main directory this should load the trained model in the main algo.</p>
  </li>
</ul>

          </article>

        </div>

    </div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5">
      <div class="container">
        Â© Copyright 2024 Somnath  Kumar. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
